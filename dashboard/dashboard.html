<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“Š Dashboard</title>
    <link rel="stylesheet" href="dashboard.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <!-- âœ… Laadt Chart.js -->
</head>
<body>

<div class="table-container">
    <h2>ğŸ“Š Dashboard</h2>
    <p id="dashboardStatus" class="loading">ğŸ“¡ Data laden...</p>

    <div class="dashboard-container">
        <div class="gauge-wrapper">
            <canvas id="macroGauge"></canvas>
            <span>ğŸ“‰ Macro</span>
        </div>

        <div class="gauge-wrapper">
            <canvas id="technicalGauge"></canvas>
            <span>ğŸ“ˆ Technisch</span>
        </div>

        <div class="gauge-wrapper">
            <canvas id="setupGauge"></canvas>
            <span>ğŸ“Š Setup</span>
        </div>
    </div>
</div>

<!-- âœ… JavaScript-bestanden laden -->
<script>
    console.log("âœ… Dashboard.js geladen!");

    const API_BASE_URL = "http://13.60.235.90:5002"; // âœ… AWS API-endpoint
    let macroGauge, technicalGauge, setupGauge;

    document.addEventListener("DOMContentLoaded", function () {
        console.log("ğŸ“Œ Dashboard wordt geladen...");
        macroGauge = createGauge("macroGauge");
        technicalGauge = createGauge("technicalGauge");
        setupGauge = createGauge("setupGauge");

        fetchDashboardData();
        setInterval(fetchDashboardData, 60000); // ğŸ”„ Elke minuut updaten
    });

    async function fetchDashboardData() {
        try {
            let response = await fetch(`${API_BASE_URL}/dashboard_data`);
            if (!response.ok) throw new Error("Fout bij ophalen dashboard-data");

            let data = await response.json();
            console.log("ğŸ“Š Dashboard API data:", data);

            // âœ… Validatie van de ontvangen data
            if (!data.macroScore || !data.technicalScore || !data.activeSetups) {
                throw new Error("âŒ Ontbrekende gegevens in de API-respons");
            }

            updateGauge(macroGauge, data.macroScore);
            updateGauge(technicalGauge, data.technicalScore);
            updateGauge(setupGauge, data.activeSetups);

            document.getElementById("dashboardStatus").textContent = "âœ… Dashboard up-to-date!";
        } catch (error) {
            console.error("âŒ Dashboard API-fout:", error);
            document.getElementById("dashboardStatus").textContent = "âŒ Fout bij laden dashboard-data.";
        }
    }

    function createGauge(elementId) {
        const ctx = document.getElementById(elementId).getContext("2d");
        return new Chart(ctx, {
            type: "doughnut",
            data: {
                labels: ["Bearish", "Neutraal", "Bullish"],
                datasets: [{
                    data: [33, 34, 33], // Gelijke verdeling in begin
                    backgroundColor: ["#ff3b30", "#f0ad4e", "#34c759"],
                    borderWidth: 0
                }]
            },
            options: {
                rotation: -90,
                circumference: 180,
                cutout: "80%",
                plugins: { legend: { display: false }, tooltip: { enabled: false } }
            }
        });
    }

    function updateGauge(gauge, score) {
        if (!gauge) return;
        let index = score >= 1 ? 2 : score <= -1 ? 0 : 1;
        gauge.data.datasets[0].data = [index === 0 ? 100 : 33, index === 1 ? 100 : 33, index === 2 ? 100 : 33];
        gauge.update();
    }
</script>

</body>
</html>
