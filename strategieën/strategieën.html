<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸ“ˆ StrategieÃ«n</title>
  <link rel="stylesheet" href="strategie/strategieÃ«n.css" />
</head>
<body>

  <!-- âœ… Navigatiebalk -->
  <nav style="background: #222; padding: 10px; text-align: center;">
    <a href="dashboard.html" style="color: white; margin: 0 15px; font-weight: bold;">ğŸ“Š Dashboard</a>
    <a href="report.html" style="color: white; margin: 0 15px; font-weight: bold;">ğŸ“„ Dagrapport</a>
    <a href="strategieÃ«n.html" style="color: #34c759; margin: 0 15px; font-weight: bold;">ğŸ“ˆ StrategieÃ«n</a>
  </nav>

  <!-- âœ… Container -->
  <div class="strategie-container">
    <h2>ğŸ“ˆ StrategieÃ«n Overzicht</h2>

    <!-- âœ… AI Strategie generatie -->
    <div class="ai-strategie-gen">
      <button id="genereerStrategieÃ«nBtn">ğŸš€ Genereer strategieÃ«n automatisch (AI)</button>
      <p id="genereerStatus" style="margin-top: 10px; font-size: 0.95rem;"></p>
    </div>

    <!-- âœ… Filters -->
    <div class="filter-controls">
      <label for="assetFilter">Asset:</label>
      <select id="assetFilter">
        <option value="ALL">Alle</option>
        <option value="BTC">Bitcoin</option>
        <option value="SOL">Solana</option>
      </select>

      <label for="timeframeFilter">Timeframe:</label>
      <select id="timeframeFilter">
        <option value="ALL">Alle</option>
        <option value="4H">4H</option>
        <option value="1D">1D</option>
        <option value="1W">1W</option>
      </select>
    </div>

    <!-- âœ… StrategieÃ«n lijst -->
    <div id="strategieLijst"></div>

    <hr style="margin: 40px 0;" />

    <!-- âœ… Strategie Toevoegen Formulier -->
    <div class="strategie-form">
      <h3>â• Strategie Toevoegen</h3>
      <form id="strategieForm">
        <label for="strategieNaam">ğŸ“Œ Naam van strategie:</label>
        <input type="text" id="strategieNaam" required placeholder="Bijv. 'BTC Swing Wyckoff'" />

        <label>ğŸ”— Koppel actieve setups:</label>
        <div id="setupCheckboxes">
          <!-- Dynamisch geladen -->
        </div>

        <label for="botGebruik">ğŸ¤– Bot gebruiken?</label>
        <select id="botGebruik">
          <option value="false">Nee</option>
          <option value="true">Ja</option>
        </select>

        <label for="scoreDrempel">ğŸ“Š Score-drempel (optioneel):</label>
        <input type="number" id="scoreDrempel" placeholder="Bijv. 7" min="0" max="10" step="0.1" />

        <label for="strategieNotities">ğŸ§  Notities of samenvatting:</label>
        <textarea id="strategieNotities" rows="3" placeholder="Bijv. 'Alleen actief in bullish marktconditie'"></textarea>

        <button type="submit">âœ… Strategie opslaan</button>
      </form>
    </div>
  </div>

  <!-- âœ… Scripts -->
  <script type="module" src="strategie/strategieÃ«n.js"></script>
  <script type="module" src="strategie/strategieÃ«n-form.js"></script>
  <script>
    const API_BASE_URL = "http://localhost:5002/api"; // pas aan indien nodig

    document.getElementById("genereerStrategieÃ«nBtn").addEventListener("click", async () => {
      const statusP = document.getElementById("genereerStatus");
      statusP.textContent = "â³ StrategieÃ«n worden gegenereerd...";
      try {
        const res = await fetch(`${API_BASE_URL}/strategie/generate_all`, { method: "POST" });
        const data = await res.json();
        if (res.ok && data.task_id) {
          statusP.textContent = "âœ… AI-strategiegeneratie gestart... (ID: " + data.task_id + ")";
          // Automatische statuscheck (optioneel)
          setTimeout(() => checkStatus(data.task_id), 5000);
        } else {
          statusP.textContent = "âš ï¸ Fout: " + (data.error || "Onbekende fout");
        }
      } catch (err) {
        console.error(err);
        statusP.textContent = "âŒ Fout bij starten van AI-strategiegeneratie";
      }
    });

    async function checkStatus(taskId) {
      const statusP = document.getElementById("genereerStatus");
      try {
        const res = await fetch(`${API_BASE_URL}/task_status/${taskId}`);
        const data = await res.json();
        if (data.status === "SUCCESS") {
          statusP.textContent = "âœ… StrategieÃ«n succesvol gegenereerd!";
        } else if (data.status === "FAILURE") {
          statusP.textContent = "âŒ Fout tijdens generatie";
        } else {
          statusP.textContent = `âŒ› Status: ${data.status}... (ID: ${taskId})`;
          setTimeout(() => checkStatus(taskId), 3000); // opnieuw checken na 3s
        }
      } catch (err) {
        statusP.textContent = "âš ï¸ Kan status niet ophalen";
        console.error(err);
      }
    }
  </script>
</body>
</html>
