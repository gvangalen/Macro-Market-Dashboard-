<!-- ✅ Market Data Tabel -->
<div class="table-container">
    <h2>📊 Market Data</h2>
    <table id="marketTable">
        <thead>
            <tr>
                <th>Crypto</th>
                <th>Open</th>
                <th>High</th>
                <th>Low</th>
                <th>Close</th>
                <th>24h % Change</th>
            </tr>
        </thead>
        <tbody id="marketBody">
            <tr>
                <td colspan="6">📡 Data laden...</td>
            </tr>
        </tbody>
    </table>
    <p id="marketStatus" class="loading">📡 Data laden...</p>
</div>

<script>
    const marketApiUrl = "http://13.60.235.90:5002/market_data"; // ✅ AWS API endpoint

    async function fetchMarketData() {
        try {
            let response = await fetch(marketApiUrl);
            if (!response.ok) throw new Error("❌ API-fout bij ophalen marktdata!");

            let data = await response.json();
            if (!data.crypto) throw new Error("❌ Geen crypto-data beschikbaar!");

            let marketBody = document.getElementById("marketBody");
            marketBody.innerHTML = ""; // 🔄 Oude data wissen

            Object.keys(data.crypto).forEach(coin => {
                let coinData = data.crypto[coin];
                
                let row = document.createElement("tr");
                row.innerHTML = `
                    <td>${coin.toUpperCase()}</td>
                    <td>$${formatNumber(coinData.open)}</td>
                    <td>$${formatNumber(coinData.high)}</td>
                    <td>$${formatNumber(coinData.low)}</td>
                    <td>$${formatNumber(coinData.close)}</td>
                    <td style="color: ${coinData.change_24h >= 0 ? "green" : "red"};">
                        ${coinData.change_24h.toFixed(2)}%
                    </td>
                `;
                marketBody.appendChild(row);
            });

            document.getElementById("marketStatus").textContent = "✅ Marktdata up-to-date!";
        } catch (error) {
            console.error(error);
            document.getElementById("marketStatus").textContent = "❌ Fout bij ophalen marktdata!";
        }
    }

    function formatNumber(num) {
        return num >= 1e9
            ? `${(num / 1e9).toFixed(2)}B`
            : num >= 1e6
            ? `${(num / 1e6).toFixed(2)}M`
            : num.toFixed(2);
    }

    document.addEventListener("DOMContentLoaded", function () {
        fetchMarketData();
        setInterval(fetchMarketData, 60000); // 🔄 Elke minuut updaten
    });
</script>
