<!-- âœ… Market Data Tabel -->
<div class="table-container">
    <h2>ðŸ“Š Market Data</h2>
    <table id="marketTable">
        <thead>
            <tr>
                <th>Crypto</th>
                <th>Open</th>
                <th>High</th>
                <th>Low</th>
                <th>Close</th>
                <th>24h % Change</th>
                <th>Market Cap</th>
                <th>24h Volume</th>
            </tr>
        </thead>
        <tbody id="marketBody">
            <tr>
                <td colspan="8">ðŸ“¡ Data laden...</td>
            </tr>
        </tbody>
    </table>
    <p id="marketStatus" class="loading">ðŸ“¡ Data laden...</p>
</div>

<script>
    const marketApiUrl = "http://13.60.235.90:5002/market_data"; // âœ… AWS API endpoint
    const allowedAssets = ["bitcoin", "solana"]; // ðŸ”¹ Pas aan als je meer munten wilt tonen

    async function fetchMarketData() {
        try {
            let response = await fetch(marketApiUrl);
            if (!response.ok) throw new Error("âŒ API-fout bij ophalen marktdata!");

            let data = await response.json();
            if (!data.crypto) throw new Error("âŒ Geen crypto-data beschikbaar!");

            let marketBody = document.getElementById("marketBody");
            marketBody.innerHTML = ""; // ðŸ”„ Oude data wissen

            // âœ… Filter alleen toegestane munten
            let filteredData = Object.keys(data.crypto)
                .filter(coin => allowedAssets.includes(coin))
                .map(coin => ({
                    name: coin.toUpperCase(),
                    ...data.crypto[coin]
                }))
                .sort((a, b) => Math.abs(b.change_24h) - Math.abs(a.change_24h)); // ðŸ”„ Sorteren op grootste beweging

            // âœ… Genereer rijen in de tabel
            filteredData.forEach(coinData => {
                let row = document.createElement("tr");
                row.innerHTML = `
                    <td>${coinData.name}</td>
                    <td>$${formatNumber(coinData.open)}</td>
                    <td>$${formatNumber(coinData.high)}</td>
                    <td>$${formatNumber(coinData.low)}</td>
                    <td>$${formatNumber(coinData.close)}</td>
                    <td style="color: ${coinData.change_24h >= 0 ? "green" : "red"};">
                        ${coinData.change_24h.toFixed(2)}%
                    </td>
                    <td>$${formatNumber(coinData.market_cap)}</td>
                    <td>$${formatNumber(coinData.volume)}</td>
                `;
                marketBody.appendChild(row);
            });

            document.getElementById("marketStatus").textContent = "âœ… Marktdata up-to-date!";
        } catch (error) {
            console.error(error);
            document.getElementById("marketStatus").textContent = "âŒ Fout bij ophalen marktdata!";
        }
    }

    function formatNumber(num) {
        return num >= 1e9
            ? `${(num / 1e9).toFixed(2)}B`
            : num >= 1e6
            ? `${(num / 1e6).toFixed(2)}M`
            : num ? num.toFixed(2) : "N/A"; // Fallback naar "N/A"
    }

    document.addEventListener("DOMContentLoaded", function () {
        fetchMarketData();
        setInterval(fetchMarketData, 60000); // ðŸ”„ Elke minuut updaten
    });
</script>
